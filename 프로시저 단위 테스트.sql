SELECT USER
FROM DUAL;


-- 테이블 단위테스트
-- 정상 케이스 2개
-- 실패 케이스 2개(권한없음, 중복 등)


-- PRC_ST_C(이름, 주민번호)
SELECT *
FROM STUD;
-- 정상케이스1
EXEC PRC_ST_C('최성훈','890505-1345756');
--==>>
/*
ST111	1234567	홍길동	770126-1234456	2024-12-01
ST112	2345671	고윤정	971208-2345671	2023-11-08
ST113	3456781	이선호	000904-3123456	2022-11-09
ST118	1345756	최성훈	890505-1345756	2026-01-27
*/
-- 정상케이스2
EXEC PRC_ST_C('최성훈', '870414-2465154');
--==>>
/*
ST111	1234567	홍길동	770126-1234456	2024-12-01
ST112	2345671	고윤정	971208-2345671	2023-11-08
ST113	3456781	이선호	000904-3123456	2022-11-09
ST118	1345756	최성훈	890505-1345756	2026-01-27
ST119	2465154	최성훈	870414-2465154	2026-01-27
*/
-- 실패케이스1
EXEC PRC_ST_C('정민성','890505-1345756');
--==>> 에러 발생
/*
unique constraint (SCOTT.ST_ST_SSN_UK) violated
*/


-- PRC_ST_U(학생아이디, 이름, 주민번호, 비밀번호)
SELECT *
FROM STUD;

-- 정상케이스1
EXEC PRC_ST_U('ST118', '유채훈', '881016-1234567', '123YCH456');
--==>>
/*
ST111	1234567	    홍길동	770126-1234456	2024-12-01
ST112	2345671	    고윤정	971208-2345671	2023-11-08
ST113	3456781	    이선호	000904-3123456	2022-11-09
ST118	123YCH456	유채훈	881016-1234567	2026-01-27
ST119	2465154	    최성훈	870414-2465154	2026-01-27
*/
-- 정상케이스2
EXEC PRC_ST_U('ST119', NULL, NULL, 'CSH890505');
--==>>
/*
ST111	1234567	    홍길동	770126-1234456	2024-12-01
ST112	2345671	    고윤정	971208-2345671	2023-11-08
ST113	3456781 	이선호	000904-3123456	2022-11-09
ST118	123YCH456	유채훈	881016-1234567	2026-01-27
ST119	CSH890505	최성훈	870414-2465154	2026-01-27
*/

-- 실패케이스 1
EXEC PRC_ST_U('ST120', '박기훈', '941216-1411777', 'CSH890505');
--==>> 예외 발생
/*
데이터가 존재하지 않습니다.
*/

-- 실패케이스2
EXEC PRC_ST_U('ST112', '박기훈', '941216-141177', 'CSH890505');
--==>> 예외 발생
/*
ORA-02290: check constraint (SCOTT.ST_ST_SSN_CK) violated
*/


-- PRC_ST_D(학생아이디)
-- 학생이 수강신청이나 성적에 없을 때만 삭제 가능
SELECT *
FROM ENROLLMENT;
-- 정상 케이스
EXEC PRC_ST_D('ST121');
SELECT *
FROM STUD;

-- 실패 케이스
EXEC PRC_ST_D('ST111');
--==>> 삭제 불가능합니다.



-- 성적 테이블 단위 테스트
SELECT *
FROM GRADE;

SELECT *
FROM PROF;
-- 교수자 아이디일 때 수강신청코드랑, 개설과목코드를 넘겼다면 그걸 어떻게 처리할 건가?
-- PRC_GR_C_PF(로그인아이디)
-- 정상 케이스1
EXEC PRC_GR_C_PF('PF101');
--==>>
/*
GR001	ER002	OS003	80	70	60	2026-03-20
GR002	ER002	OS004	75	57	45	2026-06-26
GR006	ER003	OS003	80	70	90	2026-01-27
GR007	ER003	OS004				2026-01-27
*/

-- 교수의 과목이 여러개고 학생이 여러명일때 다시 체크 (상황을 만들어서 다시 테스트하기)
-- 정상 케이스2
-- 추가가 안되고 정상적으로 나왔다고 해놓고 왜 데이터 입력은 안됐지?

-- 실패 케이스
EXEC PRC_GR_C_PF('AD101');
--==>> 권한이 없습니다.

-- 실패 케이스 (아이디에 맞는 값이 존재하지 않으면 개설과목이 없다고? 예외처리 필요할듯?)
EXEC PRC_GR_C_PF('PF111');
--==>> ORA-20020: 생성할 수 있는 성적이 없습니다.


SELECT *
FROM ENROLLMENT;
--==>> 
/*
ER001	OC001	ST111	2025-09-28
ER002	OC002	ST112	2025-10-20
ER003	OC002	ST113	2025-12-29
*/

SELECT *
FROM OPEN_SUB;
--==>>
/*
OS001	OC001	PF101	SUB001	2025-11-17	2026-02-25	TB001	20	30	50	2025-10-10
OS002	OC001	PF100	SUB002	2026-02-26	2026-04-15	TB002	20	50	30	2025-10-10
OS003	OC002	PF100	SUB001	2026-01-05	2026-03-28	TB002	30	30	40	2025-12-15
OS004	OC002	PF101	SUB002	2026-04-01	2026-06-29	TB003				2025-12-16
*/

SELECT *
FROM ADMIN;
--==>>
/*
AD100	1122333	김종서	751010-1122333	2012-01-26	AR002
AD101	2777777	조미숙	790102-2777777	2007-12-13	AR001
AD102	1552147	이기자	890810-1552147	2010-05-14	AR002
*/

SELECT *
FROM DROP_OUT;
--==>>
/*
DO001	ER001	2025-12-11	DR001
DO002	ER002	2026-06-27	DR002
*/

-- EXEC PRC_GR_C_AD(로그인아이디, 수강신청코드, 개설과목코드, 출결점수, 필기점수, 실기점수);

-- 정상 테스트
EXEC PRC_GR_C_AD('AD101', 'ER003', 'OS004', 100, 70, 80);


-- 실패 테스트
EXEC PRC_GR_C_AD('AD101', 'ER002', 'OS003', 100, 70, 80);
--==>>
/*
BEGIN PRC_GR_C_AD('AD101', 'ER002', 'OS003', 100, 70, 80); END;
오류 보고 -
ORA-20001: 중복된 데이터입니다.
ORA-06512: at "SCOTT.PRC_GR_C_AD", line 121
ORA-06512: at line 1
*/

-- 실패 테스트 1
EXEC PRC_GR_C_AD('AD101', 'ER001', 'OS002', 100, NULL, 80);
--==>> ORA-20011: 중도탈락한 학생입니다.

SELECT *
FROM GRADE;


-- PRC_GR_U(로그인아이디, 성적코드, 출결점수, 필기점수, 실기점수)

--성공 테스트
EXEC PRC_GR_U('PF101', 'GR007', 70 , 50, 40);
--==>> 
/*
GR001	ER002	OS003	80	70	60	2026-03-20
GR002	ER002	OS004	75	57	45	2026-06-26
GR006	ER003	OS003	80	70	90	2026-01-27
GR007	ER003	OS004	70	50	40	2026-01-27
*/

EXEC PRC_GR_U('AD101', 'GR006', NULL , 0, 0);
--==>>
/*
GR001	ER002	OS003	80	70	60	2026-03-20
GR002	ER002	OS004	75	57	45	2026-06-26
GR006	ER003	OS003	80	0	0	2026-01-27
GR007	ER003	OS004	70	50	40	2026-01-27
*/

EXEC PRC_GR_U('AD101', 'GR008', NULL , 0, 0);
--==>>
/*
명령의 208 행에서 시작하는 중 오류 발생 -
BEGIN PRC_GR_U('AD101', 'GR008', NULL , 0, 0); END;
오류 보고 -
ORA-20008: 유효하지 않은 성적코드입니다.
ORA-06512: at "SCOTT.PRC_GR_U", line 73
ORA-06512: at line 1

*/

EXEC PRC_GR_D('PF100', 'GR001');
--==>>
/*
명령의 220 행에서 시작하는 중 오류 발생 -
BEGIN PRC_GR_D('PF100', 'GR001'); END;
오류 보고 -
ORA-20009: 삭제할 수 있는 성적이 없습니다.
ORA-06512: at "SCOTT.PRC_GR_D", line 24
ORA-06512: at line 1
*/

SELECT *
FROM VIEW_ADMIN_PROF_LIST;

SELECT *
FROM VIEW_ADMIN_COURSE_LIST;

SELECT *
FROM VIEW_ADMIN_SUBJECT_LIST;

SELECT *
FROM VIEW_ADMIN_STUDENT_LIST;

SELECT *
FROM VIEW_PROF_SUBJECT_LIST;


SELECT *
FROM VIEW_STUDENT_SUBJECT_LIST;






--=============================================================================
-- 32. 수강신청 생성
-- PRC_ER_C(개설과정코드, 학생아이디)
EXEC PRC_ER_C('OC002', 'ST111');
--==>>
/*
ER001	OC001	ST111	2025-09-28
ER002	OC002	ST112	2025-10-20
ER003	OC002	ST113	2025-12-29
ER004	OC002	ST111	2026-01-28
*/

SELECT *
FROM OPEN_COURSE;
--==>>
/*
OC001	CR001	2025-11-17	2026-06-15	CL002	2025-10-10
OC002	CR002	2026-01-05	2026-06-29	CL001	2025-12-15
*/
SELECT *
FROM ENROLLMENT;
--==>>
/*
ER001	OC001	ST111	2025-09-28
ER002	OC002	ST112	2025-10-20
ER003	OC002	ST113	2025-12-29
*/
SELECT *
FROM STUD;
--==>>
/*
ST111	1234567	홍길동	770126-1234456	2024-12-01
ST112	2345671	고윤정	971208-2345671	2023-11-08
ST113	3456781	이선호	000904-3123456	2022-11-09
*/

EXEC PRC_ER_C('OC003', 'ST111');
--==>> ORA-20023: 존재하지 않는 개설과정입니다.

EXEC PRC_ER_C('OC002', 'ST115');
--==>> ORA-20025: 존재하지 않는 학생입니다.

EXEC PRC_ER_C('OC002', 'ST113');
--==>> ORA-20026: 이미 수강신청한 과정입니다.


-- 33. 수강신청 수정
-- PRC_ER_U(수강신청코드, 개설과정코드)

-- OC_CODE: OC001, ST_ID: ST111, ER_CODE:ER00

EXEC PRC_ER_U('ER004', 'OC002');
--==>>
/*
ER001	OC001	ST111	2025-09-28
ER002	OC002	ST112	2025-10-20
ER003	OC002	ST113	2025-12-29
ER004	OC002	ST111	2026-01-28
*/

EXEC PRC_ER_U('ER004', 'OC001');
--==>>
/*
ORA-20026: 이미 수강신청한 과정입니다.
*/

EXEC PRC_ER_U('ER005', 'OC001');
--==>> ORA-20027: 존재하지 않는 수강신청입니다.


EXEC PRC_ER_U('ER004', 'OC007');
--==>> ORA-20020: 수정할 개설과정이 존재하지 않습니다.


SELECT *
FROM ENROLLMENT;


-- 34. 수강신청삭제


EXEC PRC_OS_UB('OC002', 50, 40, 10);


SELECT *
FROM OPEN_COURSE;

SELECT *
FROM OPEN_SUB;

ROLLBACK;







